<!DOCTYPE html>
<html lang='id'>
<head>
    <meta charset="UTF-8"/>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1' name='viewport'/>
    <title>Dompet Bifold Classic Simple | Toko Dompet</title>
    
    <!-- Google Fonts & Icons -->
    <link href='https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap' rel='stylesheet'/>
    <link href='https://fonts.googleapis.com/icon?family=Material+Icons' rel='stylesheet'/>

    <!-- START: FACEBOOK PIXEL CODE - VERSI ANTI-DUPLIKAT -->
    <script>
    !function(f,b,e,v,n,t,s)
    {
        if(f.fbq)return;
        n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;
        n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)
    }(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');

    const PIXEL_ID = '688701849158753';

    // === CEK APAKAH SUDAH PERNAH DI-INIT ===
    if (!window.fbqInitialized) {
        fbq('init', PIXEL_ID);
        fbq('track', 'PageView');  // PageView hanya sekali
        window.fbqInitialized = true;  // Tandai sudah di-init
        console.log('[FB PIXEL] Pixel initialized - ID:', PIXEL_ID);
    }
    </script>
    <noscript>
        <img height="1" width="1" style="display:none"
             src="https://www.facebook.com/tr?id=688701849158753&ev=PageView&noscript=1" alt="FB Pixel"/>
    </noscript>
    <!-- END: FACEBOOK PIXEL CODE -->

    <!-- CSS (sama seperti sebelumnya) -->
    <style>
    /* ... semua CSS Anda tetap sama, tidak saya ubah ... */
    :root{--primary-color:#EE4D2D;--text-dark:#2C3E50;--text-gray:#757575;--bg-light:#F8F9FA;--white:#FFFFFF}
    body{font-family:'Poppins',sans-serif;background:#eee;margin:0;padding:0;color:var(--text-dark);font-size:14px}
    /* (sisa CSS tidak saya tulis ulang agar tidak terlalu panjang) */
    /* Anda tetap copy-paste CSS lama di sini */
    </style>
</head>
<body>

<div class='app-container'>
    <!-- semua konten Anda tetap sama -->
    
    <!-- SCRIPT UTAMA (hanya sedikit perubahan pada pengecekan fbq) -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const priceElement = document.querySelector('.detail-price');
            const nameElement = document.getElementById('productNameDisplay');

            let productPriceText = priceElement ? priceElement.textContent.trim() : '0';
            let cleanPriceString = productPriceText.replace(/[^\d]/g, '');
            const productPrice = parseInt(cleanPriceString) || 0;
            const productName = nameElement ? nameElement.textContent.trim() : 'Produk Tidak Dikenal';

            const waNumber = '6283832108529';

            const pixelProductData = {
                content_name: productName,
                value: productPrice,
                currency: 'IDR',
                content_ids: ['SKU-DB-002'],
                content_type: 'product'
            };

            // === VIEWCONTENT (hanya sekali per halaman) ===
            if (typeof fbq === 'function' && !window.viewContentFired) {
                fbq('track', 'ViewContent', pixelProductData);
                window.viewContentFired = true;
                console.log('[PIXEL] ViewContent Fired - Rp' + productPrice);
            }

            // === Slider, varian, dll (sama seperti sebelumnya) ===
            const sliderContainer = document.getElementById('productSlider');
            const counter = document.getElementById('sliderCounter');
            const buyButton = document.getElementById('buyButton');
            const chatButton = document.getElementById('chatButton');
            const variantBoxes = document.querySelectorAll('.variant-box');

            // Slider counter
            const imgArray = sliderContainer.querySelectorAll('.slider-item');
            const totalSlides = imgArray.length;
            if (totalSlides > 0) {
                counter.innerText = "1/" + totalSlides;
                sliderContainer.addEventListener('scroll', function() {
                    const index = Math.round(this.scrollLeft / this.offsetWidth) + 1;
                    counter.innerText = (index > totalSlides ? totalSlides : index) + "/" + totalSlides;
                });
            }

            // Varian & link WA
            let selectedVariant = 'Coklat';
            variantBoxes.forEach(box => {
                box.addEventListener('click', function() {
                    variantBoxes.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedVariant = this.getAttribute('data-variant');

                    const waText = encodeURIComponent(`Halo, saya mau beli \( {productName} Warna \){selectedVariant}.`);
                    buyButton.href = `https://wa.me/\( {waNumber}?text= \){waText}`;

                    // AddToCart setiap kali varian dipilih
                    if (typeof fbq === 'function') {
                        fbq('track', 'AddToCart', pixelProductData);
                        console.log('[PIXEL] AddToCart - ' + selectedVariant);
                    }
                });
            });

            // Trigger varian default
            document.querySelector('.variant-box.active')?.click();

            // Tombol Chat → Contact
            chatButton?.addEventListener('click', () => {
                if (typeof fbq === 'function') fbq('track', 'Contact', pixelProductData);
            });

            // Tombol Beli → InitiateCheckout
            buyButton?.addEventListener('click', () => {
                if (typeof fbq === 'function') fbq('track', 'InitiateCheckout', pixelProductData);
            });
        });
    </script>
</div>
</body>
</html>
